<div class="container-fluid">
  <!-- Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h4 class="mb-1">
            <i class="feather icon-credit-card me-2"></i>
            {{ isEditing ? 'Editar Forma de Pago' : 'Nueva Forma de Pago' }}
          </h4>
          <p class="text-muted mb-0">
            Configura los detalles, reglas y disponibilidad de la forma de pago
          </p>
        </div>
        <button type="button" class="btn btn-secondary" (click)="goBack()">
          <i class="feather icon-arrow-left me-1"></i>
          Volver
        </button>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <form (ngSubmit)="onSubmit()" #paymentForm="ngForm">
            <!-- Información Básica -->
            <div class="row mb-4">
              <div class="col-12">
                <h6 class="text-primary mb-3">
                  <i class="feather icon-info me-2"></i>
                  Información Básica
                </h6>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Nombre <span class="text-danger">*</span></label>
                <input type="text"
                       class="form-control"
                       [(ngModel)]="paymentMethod.name"
                       name="name"
                       required
                       placeholder="Ej: Tarjeta de Crédito Visa">
              </div>
              <div class="col-md-6">
                <label class="form-label">Código <span class="text-danger">*</span></label>
                <input type="text"
                       class="form-control text-uppercase"
                       [(ngModel)]="paymentMethod.code"
                       name="code"
                       required
                       placeholder="Ej: VISA"
                       maxlength="10">
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Tipo <span class="text-danger">*</span></label>
                <select class="form-select"
                        [(ngModel)]="paymentMethod.type"
                        name="type"
                        required
                        (change)="onTypeChange()">
                  <option value="">Seleccionar tipo</option>
                  <option *ngFor="let type of paymentTypes" [value]="type.value">
                    <i class="feather icon-{{ type.icon }} me-1"></i>
                    {{ type.label }}
                  </option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Moneda <span class="text-danger">*</span></label>
                <select class="form-select"
                        [(ngModel)]="paymentMethod.currency"
                        name="currency"
                        required>
                  <option *ngFor="let currency of currencies" [value]="currency.value">
                    {{ currency.label }}
                  </option>
                </select>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-12">
                <label class="form-label">Descripción <span class="text-danger">*</span></label>
                <textarea class="form-control"
                          rows="3"
                          [(ngModel)]="paymentMethod.description"
                          name="description"
                          required
                          placeholder="Descripción detallada de la forma de pago..."></textarea>
              </div>
            </div>

            <!-- Configuración -->
            <div class="row mb-4">
              <div class="col-12">
                <h6 class="text-primary mb-3">
                  <i class="feather icon-settings me-2"></i>
                  Configuración
                </h6>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <div class="form-check form-switch">
                  <input class="form-check-input"
                         type="checkbox"
                         [(ngModel)]="paymentMethod.isActive"
                         name="isActive"
                         id="isActive">
                  <label class="form-check-label" for="isActive">
                    Forma de pago activa
                  </label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-check form-switch">
                  <input class="form-check-input"
                         type="checkbox"
                         [(ngModel)]="paymentMethod.requiresReference"
                         name="requiresReference"
                         id="requiresReference">
                  <label class="form-check-label" for="requiresReference">
                    Requiere referencia
                  </label>
                </div>
              </div>
            </div>

            <!-- Configuración específica por tipo -->
            <div *ngIf="paymentMethod.type === 'card'" class="row mb-4">
              <div class="col-12">
                <h6 class="text-primary mb-3">
                  <i class="feather icon-credit-card me-2"></i>
                  Configuración de Tarjetas
                </h6>
              </div>
            </div>

            <div *ngIf="paymentMethod.type === 'card'" class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Comisión (%)</label>
                <input type="number"
                       class="form-control"
                       [(ngModel)]="paymentMethod.processingFee"
                       name="processingFee"
                       step="0.01"
                       min="0"
                       max="100"
                       placeholder="2.9">
              </div>
              <div class="col-md-6">
                <label class="form-label">Monto Máximo</label>
                <input type="number"
                       class="form-control"
                       [(ngModel)]="paymentMethod.maxAmount"
                       name="maxAmount"
                       step="0.01"
                       min="0"
                       [placeholder]="'Ej: ' + formatCurrency(50000)">
              </div>
            </div>

            <div *ngIf="paymentMethod.type === 'card'" class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Monto Mínimo</label>
                <input type="number"
                       class="form-control"
                       [(ngModel)]="paymentMethod.minimumAmount"
                       name="minimumAmount"
                       step="0.01"
                       min="0"
                       [placeholder]="'Ej: ' + formatCurrency(100)">
              </div>
              <div class="col-md-6">
                <label class="form-label">Tipos de Tarjeta Aceptadas <span class="text-danger">*</span></label>
                <div class="card-type-selector">
                  <div *ngFor="let cardType of cardTypes" class="form-check form-check-inline">
                    <input class="form-check-input"
                           type="checkbox"
                           [id]="'card-' + cardType.value"
                           [checked]="isCardTypeSelected(cardType.value)"
                           (change)="toggleCardType(cardType.value)">
                    <label class="form-check-label" [for]="'card-' + cardType.value">
                      {{ cardType.label }}
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Configuración bancaria -->
            <div *ngIf="paymentMethod.type === 'transfer'" class="row mb-4">
              <div class="col-12">
                <h6 class="text-primary mb-3">
                  <i class="feather icon-home me-2"></i>
                  Información Bancaria
                </h6>
              </div>
            </div>

            <div *ngIf="paymentMethod.type === 'transfer'" class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Nombre del Banco <span class="text-danger">*</span></label>
                <input type="text"
                       class="form-control"
                       [(ngModel)]="paymentMethod.bankName"
                       name="bankName"
                       required
                       placeholder="Ej: Banco Popular Dominicano">
              </div>
              <div class="col-md-6">
                <label class="form-label">Número de Cuenta <span class="text-danger">*</span></label>
                <input type="text"
                       class="form-control"
                       [(ngModel)]="paymentMethod.accountNumber"
                       name="accountNumber"
                       required
                       placeholder="Ej: 123456789012">
              </div>
            </div>

            <div *ngIf="paymentMethod.type === 'transfer'" class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Código de Ruta</label>
                <input type="text"
                       class="form-control"
                       [(ngModel)]="paymentMethod.routingNumber"
                       name="routingNumber"
                       placeholder="Ej: 123456789">
              </div>
            </div>

            <!-- Notas adicionales -->
            <div class="row mb-4">
              <div class="col-12">
                <h6 class="text-primary mb-3">
                  <i class="feather icon-file-text me-2"></i>
                  Notas Adicionales
                </h6>
              </div>
            </div>

            <div class="row mb-4">
              <div class="col-12">
                <label class="form-label">Observaciones</label>
                <textarea class="form-control"
                          rows="3"
                          [(ngModel)]="paymentMethod.notes"
                          name="notes"
                          placeholder="Información adicional sobre esta forma de pago..."></textarea>
              </div>
            </div>

            <!-- Botones -->
            <div class="row">
              <div class="col-12">
                <div class="d-flex justify-content-end gap-2">
                  <button type="button" class="btn btn-secondary" (click)="goBack()">
                    <i class="feather icon-x me-1"></i>
                    Cancelar
                  </button>
                  <button type="submit"
                          class="btn btn-primary"
                          [disabled]="!paymentForm.form.valid">
                    <i class="feather icon-save me-1"></i>
                    {{ isEditing ? 'Actualizar Forma de Pago' : 'Crear Forma de Pago' }}
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
