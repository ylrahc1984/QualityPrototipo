<div class="factura-form">
  <div class="form-header">
    <div>
      <p class="eyebrow">Nueva Factura</p>
      <h4>Registro rapido</h4>
      <p class="subtitle">Completa datos basicos y agrega los items del detalle.</p>
    </div>
    <div class="header-total">
      <span>Total estimado</span>
      <strong>{{ totalFactura() | currency:factura.moneda:'symbol':'1.2-2' }}</strong>
    </div>
  </div>

  <div class="form-grid">
    <div class="form-group">
      <label>Numero</label>
      <input type="text" class="form-control" [(ngModel)]="factura.numero">
    </div>
    <div class="form-group">
      <label>Cliente</label>
      <input type="text" class="form-control" [(ngModel)]="factura.cliente" placeholder="Nombre o razon social">
    </div>
    <div class="form-group">
      <label>Fecha</label>
      <input type="date" class="form-control" [(ngModel)]="factura.fecha">
    </div>
    <div class="form-group">
      <label>Moneda</label>
      <select class="form-control" [(ngModel)]="factura.moneda">
        <option *ngFor="let moneda of monedas" [value]="moneda">{{ moneda }}</option>
      </select>
    </div>
    <div class="form-group">
      <label>Forma de pago</label>
      <select class="form-control" [(ngModel)]="factura.formaPago">
        <option *ngFor="let fp of formasPago" [value]="fp">{{ fp }}</option>
      </select>
    </div>
    <div class="form-group full-width">
      <label>Notas</label>
      <textarea class="form-control" rows="2" [(ngModel)]="factura.notas" placeholder="Instrucciones o comentarios"></textarea>
    </div>
  </div>

  <div class="detalle-card">
    <div class="detalle-header">
      <h5>Detalle de items</h5>
      <button class="btn btn-light btn-sm" type="button" (click)="addItem()">
        <i class="feather icon-plus"></i> Agregar item
      </button>
    </div>

    <div class="table-responsive">
      <table class="table table-sm table-borderless align-middle">
        <thead>
          <tr>
            <th>Descripcion</th>
            <th class="w-120">Cantidad</th>
            <th class="w-140">Precio</th>
            <th class="w-140 text-right">Importe</th>
            <th class="w-80 text-right">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of items; let i = index">
            <td>
              <input type="text" class="form-control" [(ngModel)]="item.descripcion" placeholder="Concepto">
            </td>
            <td>
              <input type="number" class="form-control" min="0" step="1" [(ngModel)]="item.cantidad">
            </td>
            <td>
              <input type="number" class="form-control" min="0" step="0.01" [(ngModel)]="item.precio">
            </td>
            <td class="text-right">
              {{ totalLinea(item) | currency:factura.moneda:'symbol':'1.2-2' }}
            </td>
            <td class="text-right">
              <button class="btn btn-sm btn-outline-danger" type="button" (click)="removeItem(i)" [disabled]="items.length === 1">
                <i class="feather icon-trash-2"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="detalle-footer">
      <div class="actions primary-actions">
        <button class="btn btn-primary" type="button" (click)="guardarFactura()">
          <i class="feather icon-save"></i> Guardar factura
        </button>
        <button class="btn btn-outline-secondary" type="button" (click)="cancelar()">
          <i class="feather icon-arrow-left"></i> Cancelar
        </button>
        <button class="btn btn-light" type="button" (click)="limpiar()">
          <i class="feather icon-rotate-ccw"></i> Limpiar
        </button>
      </div>

      <div class="totales-panel">
        <div class="totales-row">
          <span>Sub total</span>
          <strong>{{ subtotal() | currency:factura.moneda:'symbol':'1.2-2' }}</strong>
        </div>
        <div class="totales-row">
          <span>Descuento</span>
          <div class="input-inline">
            <input type="number" class="form-control" min="0" [(ngModel)]="descuento">
            <small class="text-muted">monto</small>
          </div>
        </div>
        <div class="totales-row">
          <span>Neto</span>
          <strong>{{ neto() | currency:factura.moneda:'symbol':'1.2-2' }}</strong>
        </div>
        <div class="totales-row">
          <span>Impuesto</span>
          <div class="input-inline">
            <input type="number" class="form-control" min="0" [(ngModel)]="impuestoPorcentaje">
            <small class="text-muted">% sobre neto</small>
          </div>
          <strong class="ml-auto">{{ impuestoMonto() | currency:factura.moneda:'symbol':'1.2-2' }}</strong>
        </div>
        <div class="totales-row total">
          <span>Total</span>
          <strong>{{ totalFactura() | currency:factura.moneda:'symbol':'1.2-2' }}</strong>
        </div>
      </div>
    </div>
  </div>
</div>
