<div class="row">
  <div class="col-12">
    <app-card>
      <div class="consulta-header">
        <div>
          <p class="eyebrow">Consulta</p>
          <h4>Facturas</h4>
          <p class="subtitle">Filtra por cliente, numero, estado o rango de fechas.</p>
        </div>
        <div class="header-right">
          <div class="header-stats">
            <div class="stat">
              <span class="stat-label">Registros</span>
              <strong class="stat-value">{{ filteredFacturas().length }}</strong>
            </div>
            <div class="stat">
              <span class="stat-label">Total filtrado</span>
              <strong class="stat-value">
                {{ getTotalFiltrado() | currency:'USD':'symbol':'1.0-0' }}
              </strong>
            </div>
          </div>
          <div class="header-actions">
            <a class="btn btn-primary" [routerLink]="['/facturas/nueva']">
              <i class="feather icon-plus"></i>
              Nueva factura
            </a>
          </div>
        </div>
      </div>

      <div class="filters-grid">
        <div class="filter-group">
          <label>Cliente o numero</label>
          <div class="input-icon">
            <i class="feather icon-search"></i>
            <input
              type="text"
              class="form-control"
              placeholder="Busca por cliente o numero"
              [(ngModel)]="filtros.buscar"
              (ngModelChange)="resetPagina()">
          </div>
        </div>
        <div class="filter-group">
          <label>Estado</label>
          <select
            class="form-control"
            [(ngModel)]="filtros.estado"
            (ngModelChange)="resetPagina()">
            <option value="todos">Todos</option>
            <option value="emitida">Emitida</option>
            <option value="pagada">Pagada</option>
            <option value="anulada">Anulada</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Desde</label>
          <input
            type="date"
            class="form-control"
            [(ngModel)]="filtros.desde"
            (change)="resetPagina()">
        </div>
        <div class="filter-group">
          <label>Hasta</label>
          <input
            type="date"
            class="form-control"
            [(ngModel)]="filtros.hasta"
            (change)="resetPagina()">
        </div>
        <div class="filter-actions">
          <button class="btn btn-light" type="button" (click)="resetFiltros()">
            <i class="feather icon-rotate-ccw"></i>
            Limpiar
          </button>
        </div>
      </div>

      <div class="table-wrapper">
        <div class="table-responsive">
          <table class="table table-striped table-hover consulta-table">
            <thead>
              <tr>
                <th>Numero</th>
                <th>Cliente</th>
                <th>Monto</th>
                <th>Fecha</th>
                <th>Estado</th>
                <th class="text-right">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let factura of pagedFacturas()">
                <td>{{ factura.numero }}</td>
                <td>{{ factura.cliente }}</td>
                <td><span class="monto">{{ factura.monto | currency:'USD':'symbol':'1.0-0' }}</span></td>
                <td>{{ factura.fecha | date:'yyyy-MM-dd' }}</td>
                <td>
                  <span class="estado-pill" [ngClass]="getEstadoClase(factura.estado)">
                    {{ factura.estado | titlecase }}
                  </span>
                </td>
                <td class="text-right">
                  <div class="row-actions">
                    <button class="btn btn-sm btn-outline-primary" type="button">
                      <i class="feather icon-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" type="button">
                      <i class="feather icon-printer"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div *ngIf="filteredFacturas().length === 0" class="empty-state">
          <i class="feather icon-inbox"></i>
          <p>Sin resultados para los filtros aplicados.</p>
        </div>
      </div>

      <div class="table-footer">
        <div class="page-size">
          <label>Mostrar</label>
          <select [ngModel]="pageSize" (ngModelChange)="onPageSizeChange($event)" class="form-control">
            <option *ngFor="let size of pageSizes" [value]="size">{{ size }}</option>
          </select>
          <span>por pagina</span>
        </div>

        <div class="pagination-controls">
          <button class="btn btn-light" type="button" (click)="changePage(-1)" [disabled]="page === 1">
            <i class="feather icon-chevron-left"></i>
          </button>
          <span>Pagina {{ page }} de {{ totalPaginas() }}</span>
          <button class="btn btn-light" type="button" (click)="changePage(1)" [disabled]="page === totalPaginas()">
            <i class="feather icon-chevron-right"></i>
          </button>
        </div>

        <div class="footer-actions">
          <button class="btn btn-outline-secondary" type="button" (click)="imprimir()">
            <i class="feather icon-printer"></i>
            Imprimir
          </button>
          <button class="btn btn-outline-primary" type="button" (click)="exportarExcel()">
            <i class="feather icon-download"></i>
            Exportar Excel
          </button>
        </div>
      </div>
    </app-card>
  </div>
</div>
