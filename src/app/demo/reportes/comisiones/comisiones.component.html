<div class="row">
  <div class="col-12">
    <app-card>
      <div class="consulta-header">
        <div class="company-card">
          <p class="eyebrow">Reporte de comisiones</p>
          <h4>{{ infoEmpresa.nombre }}</h4>
          <p class="subtitle">{{ infoEmpresa.ubicacion }} - {{ infoEmpresa.cedula }}</p>
          <p class="subtitle">Telefono: {{ infoEmpresa.telefono }} - Fax: {{ infoEmpresa.fax }}</p>
        </div>
        <div class="header-right">

          <div class="header-actions">
            <button class="btn btn-outline-primary" type="button" (click)="exportarExcel()">
              <i class="feather icon-download"></i>
              Exportar Excel
            </button>
            <button class="btn btn-outline-secondary" type="button" (click)="imprimir()">
              <i class="feather icon-printer"></i>
              Imprimir
            </button>
          </div>
        </div>
      </div>

      <div class="filters-grid">
        <div class="filter-group">
          <label>Estado</label>
          <select class="form-control" [(ngModel)]="filtros.estado" (ngModelChange)="resetPagina()">
            <option value="todos">Todos</option>
            <option value="pendiente">Pendiente</option>
            <option value="pagada">Pagada</option>
            <option value="retenida">Retenida</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Agencia</label>
          <select class="form-control" [(ngModel)]="filtros.agencia" (ngModelChange)="resetPagina()">
            <option value="todos">Todos</option>
            <option *ngFor="let a of agencias" [value]="a">{{ a }}</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Desde</label>
          <input type="date" class="form-control" [(ngModel)]="filtros.desde" (change)="resetPagina()">
        </div>
        <div class="filter-group">
          <label>Hasta</label>
          <input type="date" class="form-control" [(ngModel)]="filtros.hasta" (change)="resetPagina()">
        </div>
        <div class="filter-group wide">
          <label>Agencia / Cliente / Boleta</label>
          <div class="input-icon">
            <i class="feather icon-search"></i>
            <input
              type="text"
              class="form-control"
              placeholder="Busca por agencia, cliente o boleta"
              [(ngModel)]="filtros.buscar"
              (ngModelChange)="resetPagina()">
          </div>
        </div>
        <div class="filter-actions">
          <button class="btn btn-light" type="button" (click)="resetFiltros()">
            <i class="feather icon-rotate-ccw"></i>
            Limpiar
          </button>
        </div>
      </div>

      <div class="table-wrapper">
        <div class="table-responsive">
          <table class="table table-striped table-hover consulta-table">
            <thead>
              <tr>
                <th>Boleta</th>
                <th>Fecha</th>
                <th>Tipo Servicio</th>
                <th>Hora Pick Up</th>
                <th>Pax</th>
                <th>Cliente</th>
                <th>Origen</th>
                <th>Destino</th>
                <th>Agencia</th>
                <th>Costo Rack</th>
                <th>Neto</th>
                <th>Comision</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let com of pagedComisiones()">
                <td>{{ com.boleta }}</td>
                <td>{{ com.fecha | date:'dd/MM/yyyy' }}</td>
                <td>{{ com.tipoServicio }}</td>
                <td>{{ com.horaPickUp }}</td>
                <td>{{ com.pax }}</td>
                <td>{{ com.cliente }}</td>
                <td>{{ com.origen }}</td>
                <td>{{ com.destino }}</td>
                <td>{{ com.agencia }}</td>
                <td><span class="monto">{{ com.costoRack | number:'1.0-2' }}</span></td>
                <td><span class="monto">{{ com.neto | number:'1.0-2' }}</span></td>
                <td><span class="monto">{{ com.comision | number:'1.0-2' }}</span></td>
              </tr>
              <tr *ngIf="filteredComisiones().length">
                <td colspan="9" class="text-right font-weight-bold">Totales generales</td>
                <td><span class="monto">{{ totalBase() | number:'1.0-2' }}</span></td>
                <td><span class="monto">{{ totalNeto() | number:'1.0-2' }}</span></td>
                <td><span class="monto">{{ totalMonto() | number:'1.0-2' }}</span></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div *ngIf="filteredComisiones().length === 0" class="empty-state">
          <i class="feather icon-inbox"></i>
          <p>Sin resultados para los filtros aplicados.</p>
        </div>
      </div>

      <div class="table-footer">
        <div class="page-size">
          <label>Mostrar</label>
          <select [ngModel]="pageSize" (ngModelChange)="onPageSizeChange($event)" class="form-control">
            <option *ngFor="let size of pageSizes" [value]="size">{{ size }}</option>
          </select>
          <span>por pagina</span>
        </div>

        <div class="pagination-controls">
          <button class="btn btn-light" type="button" (click)="changePage(-1)" [disabled]="page === 1">
            <i class="feather icon-chevron-left"></i>
          </button>
          <span>Pagina {{ page }} de {{ totalPaginas() }}</span>
          <button class="btn btn-light" type="button" (click)="changePage(1)" [disabled]="page === totalPaginas()">
            <i class="feather icon-chevron-right"></i>
          </button>
        </div>

        <div class="footer-right">
          <div class="footer-actions">
            <button class="btn btn-outline-secondary" type="button" (click)="imprimir()">
              <i class="feather icon-printer"></i>
              Imprimir
            </button>
            <button class="btn btn-outline-primary" type="button" (click)="exportarExcel()">
              <i class="feather icon-download"></i>
              Exportar Excel
            </button>
          </div>
        </div>
      </div>
    </app-card>
  </div>
</div>
