<div class="row">
  <div class="col-12">
    <app-card>
      <div class="consulta-header">
        <div>
          <p class="eyebrow">Reporte</p>
          <h4>Reservas</h4>
          <p class="subtitle">Vista resumida de reservas con filtros por agencia, estado y rango de fechas.</p>
        </div>
        <div class="header-right">
          <div class="header-stats">
            <div class="stat">
              <span class="stat-label">Registros</span>
              <strong class="stat-value">{{ filteredReservas().length }}</strong>
            </div>
            <div class="stat">
              <span class="stat-label">Total filtrado</span>
              <strong class="stat-value">{{ totalFiltrado() | currency:'USD':'symbol':'1.0-0' }}</strong>
            </div>
          </div>
          <div class="header-actions">
            <button class="btn btn-outline-primary" type="button" (click)="exportarExcel()">
              <i class="feather icon-download"></i>
              Exportar Excel
            </button>
            <button class="btn btn-outline-secondary" type="button" (click)="imprimir()">
              <i class="feather icon-printer"></i>
              Imprimir
            </button>
          </div>
        </div>
      </div>

      <div class="filters-grid">
        <div class="filter-group">
          <label>Agencia</label>
          <select class="form-control" [(ngModel)]="filtros.agencia" (ngModelChange)="resetPagina()">
            <option value="todos">Todas</option>
            <option *ngFor="let a of agencias" [value]="a">{{ a }}</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Estado</label>
          <select class="form-control" [(ngModel)]="filtros.estado" (ngModelChange)="resetPagina()">
            <option value="todos">Todos</option>
            <option value="confirmada">Confirmada</option>
            <option value="pendiente">Pendiente</option>
            <option value="cancelada">Cancelada</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Desde</label>
          <input type="date" class="form-control" [(ngModel)]="filtros.desde" (change)="resetPagina()">
        </div>
        <div class="filter-group">
          <label>Hasta</label>
          <input type="date" class="form-control" [(ngModel)]="filtros.hasta" (change)="resetPagina()">
        </div>
        <div class="filter-group wide">
          <label>Cliente / Servicio / Codigo</label>
          <div class="input-icon">
            <i class="feather icon-search"></i>
            <input
              type="text"
              class="form-control"
              placeholder="Busca por cliente, servicio o codigo"
              [(ngModel)]="filtros.buscar"
              (ngModelChange)="resetPagina()">
          </div>
        </div>
        <div class="filter-actions">
          <button class="btn btn-light" type="button" (click)="resetFiltros()">
            <i class="feather icon-rotate-ccw"></i>
            Limpiar
          </button>
        </div>
      </div>

      <div class="table-wrapper">
        <div class="table-responsive">
          <table class="table table-striped table-hover consulta-table">
            <thead>
              <tr>
                <th>Codigo</th>
                <th>Fecha</th>
                <th>Hora</th>
                <th>Servicio</th>
                <th>Cliente</th>
                <th>Origen</th>
                <th>Destino</th>
                <th>Pax</th>
                <th>Agencia</th>
                <th>Estado</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let r of pagedReservas()">
                <td>{{ r.codigo }}</td>
                <td>{{ r.fecha | date:'dd/MM/yyyy' }}</td>
                <td>{{ r.hora }}</td>
                <td>{{ r.servicio }}</td>
                <td>{{ r.cliente }}</td>
                <td>{{ r.origen }}</td>
                <td>{{ r.destino }}</td>
                <td>{{ r.pax }}</td>
                <td>{{ r.agencia }}</td>
                <td>
                  <span class="estado-pill" [ngClass]="getEstadoClase(r.estado)">
                    {{ r.estado | titlecase }}
                  </span>
                </td>
                <td><span class="monto">{{ r.total | currency:'USD':'symbol':'1.0-0' }}</span></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div *ngIf="filteredReservas().length === 0" class="empty-state">
          <i class="feather icon-inbox"></i>
          <p>Sin resultados para los filtros aplicados.</p>
        </div>
      </div>

      <div class="table-footer">
        <div class="page-size">
          <label>Mostrar</label>
          <select [ngModel]="pageSize" (ngModelChange)="onPageSizeChange($event)" class="form-control">
            <option *ngFor="let size of pageSizes" [value]="size">{{ size }}</option>
          </select>
          <span>por pagina</span>
        </div>

        <div class="pagination-controls">
          <button class="btn btn-light" type="button" (click)="changePage(-1)" [disabled]="page === 1">
            <i class="feather icon-chevron-left"></i>
          </button>
          <span>Pagina {{ page }} de {{ totalPaginas() }}</span>
          <button class="btn btn-light" type="button" (click)="changePage(1)" [disabled]="page === totalPaginas()">
            <i class="feather icon-chevron-right"></i>
          </button>
        </div>

        <div class="footer-actions">
          <button class="btn btn-outline-secondary" type="button" (click)="imprimir()">
            <i class="feather icon-printer"></i>
            Imprimir
          </button>
          <button class="btn btn-outline-primary" type="button" (click)="exportarExcel()">
            <i class="feather icon-download"></i>
            Exportar Excel
          </button>
        </div>
      </div>
    </app-card>
  </div>
</div>
